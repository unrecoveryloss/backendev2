{% extends "crud/base_form.html" %}
{% load static %}

{% block form_content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    {% if action == 'edit' %}Editar Producto{% else %}Crear Producto{% endif %}
                </h4>
            </div>
            <div class="card-body">
                <form method="post" id="productoForm" enctype="multipart/form-data" data-custom-validation="true">
                    {% csrf_token %}
                    
                    <!-- Información básica -->
                    <div class="mb-4">
                        <h5 class="text-primary">Información Básica</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="id_sku" class="form-label">SKU</label>
                                <input type="text" class="form-control" id="id_sku" name="sku" 
                                       value="{{ form.sku.value|default:'' }}" maxlength="50">
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="id_ean_upc" class="form-label">EAN/UPC</label>
                                <input type="text" class="form-control" id="id_ean_upc" name="ean_upc" 
                                       value="{{ form.ean_upc.value|default:'' }}" maxlength="50">
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="id_nombre" class="form-label">Nombre del producto (requerido)</label>
                                <input type="text" class="form-control" id="id_nombre" name="nombre" 
                                       value="{{ form.nombre.value|default:'' }}" maxlength="100" required>
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="id_descripcion" class="form-label">Descripción</label>
                                <textarea class="form-control" id="id_descripcion" name="descripcion" 
                                          rows="3" maxlength="500">{{ form.descripcion.value|default:'' }}</textarea>
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="id_categoria" class="form-label">Categoría</label>
                                <select class="form-select" id="id_categoria" name="categoria">
                                    <option value="">Seleccione una categoría</option>
                                    {% for categoria in categorias %}
                                    <option value="{{ categoria.id }}" 
                                            {% if form.categoria.value == categoria.id %}selected{% endif %}>
                                        {{ categoria.nombre }}
                                    </option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="id_marca" class="form-label">Marca</label>
                                <input type="text" class="form-control" id="id_marca" name="marca" 
                                       value="{{ form.marca.value|default:'' }}" maxlength="50">
                                <div class="invalid-feedback"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Precios y stock -->
                    <div class="mb-4">
                        <h5 class="text-primary">Precios y Stock</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="id_precio_venta" class="form-label">Precio de venta (requerido)</label>
                                <input type="number" class="form-control" id="id_precio_venta" name="precio_venta" 
                                       value="{{ form.precio_venta.value|default:'' }}" step="0.01" min="0" required>
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="id_costo_estandar" class="form-label">Costo estándar</label>
                                <input type="number" class="form-control" id="id_costo_estandar" name="costo_estandar" 
                                       value="{{ form.costo_estandar.value|default:'' }}" step="0.01" min="0">
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="id_stock_minimo" class="form-label">Stock mínimo</label>
                                <input type="number" class="form-control" id="id_stock_minimo" name="stock_minimo" 
                                       value="{{ form.stock_minimo.value|default:0 }}" min="0">
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="id_stock_maximo" class="form-label">Stock máximo</label>
                                <input type="number" class="form-control" id="id_stock_maximo" name="stock_maximo" 
                                       value="{{ form.stock_maximo.value|default:'' }}" min="0">
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-12 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="id_impuesto_iva" name="impuesto_iva" 
                                           {% if form.impuesto_iva.value %}checked{% endif %}>
                                    <label class="form-check-label" for="id_impuesto_iva">
                                        Aplica IVA (19%)
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Imagen -->
                    <div class="mb-4">
                        <h5 class="text-primary">Imagen del Producto</h5>
                        <div class="mb-3">
                            <label for="id_imagen" class="form-label">Imagen</label>
                            <input type="file" class="form-control" id="id_imagen" name="imagen" accept="image/*">
                            <div class="invalid-feedback"></div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Guardar
                        </button>
                        <a href="{% url 'productos_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>Volver
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('productoForm').addEventListener('submit', function(e) {
    // Validación básica
    const requiredFields = ['nombre', 'precio_venta'];
    let isValid = true;
    
    requiredFields.forEach(fieldName => {
        const field = document.getElementById(`id_${fieldName}`);
        if (!field.value.trim()) {
            field.classList.add('is-invalid');
            isValid = false;
        } else {
            field.classList.remove('is-invalid');
        }
    });
    
    if (!isValid) {
        e.preventDefault();
        alert('Por favor, complete todos los campos requeridos');
        return;
    }
    
    // Permitir que el formulario se envíe normalmente
});
</script>
{% endblock %}
